# Filters Documentation

## Overview
Папка содержит фильтры для обработки сообщений и проверки различных условий в Telegram боте.

## Files Structure

### __init__.py
Пустой файл для обозначения папки как Python-пакета.

### chat_type.py
Фильтр для проверки типа чата.

#### Классы:
- `ChatTypeFilter(BaseFilter)`
  - Проверяет тип чата (личный, группа и т.д.)
  - Параметры:
    - `chat_type: Union[str, list]` - Допустимый тип(ы) чата
  - Методы:
    - `__call__(message: Message) -> bool`
      - Сравнивает тип чата с допустимым
      - Поддерживает как одиночное значение, так и список типов

### is_admin.py
Фильтр для проверки прав администратора.

#### Классы:
- `IsAdminFilter(BaseFilter)`
  - Проверяет, является ли пользователь администратором
  - Параметры:
    - `is_admin: bool` - Ожидаемый статус админа
  - Методы:
    - `__init__(is_admin: bool)`
      - Инициализирует фильтр и загружает конфигурацию
    - `__call__(message: Message) -> bool`
      - Проверяет ID пользователя в списке owners из конфигурации
      - Логирует все этапы проверки
      - Обрабатывает ошибки с возвратом False

### is_owner.py
Фильтр для проверки владельца бота.

#### Классы:
- `IsOwnerFilter(BaseFilter)`
  - Проверяет, является ли пользователь владельцем бота
  - Параметры:
    - `is_owner: bool` - Ожидаемый статус владельца
  - Методы:
    - `__init__(is_owner: bool)`
      - Инициализирует фильтр и загружает конфигурацию
    - `__call__(message: Message) -> bool`
      - Проверяет ID пользователя в списке owners
      - Логирует процесс проверки
      - Обрабатывает ошибки

### is_subscribed.py
Фильтр для проверки подписки на канал.

#### Классы:
- `IsSubscribedFilter(BaseFilter)`
  - Проверяет подписку пользователя на обязательный канал
  - Методы:
    - `__init__()`
      - Загружает ID канала из конфигурации
    - `__call__(event: Union[Message, CallbackQuery]) -> bool`
      - Проверяет статус участника в канале
      - Поддерживает сообщения и callback-запросы
      - Детально логирует процесс проверки
      - Учитывает разные статусы участника (creator, administrator, member)

### referral.py
Фильтры для работы с реферальной системой.

#### Классы:
- `ReferralCommandFilter(BaseFilter)`
  - Проверяет наличие реферального кода в команде
  - Методы:
    - `__call__(message: Message) -> bool`
      - Проверяет наличие параметра ref_ в команде
      - Логирует детали проверки

- `RegularStartCommandFilter(BaseFilter)`
  - Проверяет, что команда start без реферального кода
  - Методы:
    - `__call__(message: Message) -> bool`
      - Проверяет отсутствие дополнительных параметров

## Dependencies
- `aiogram` - Базовые классы фильтров
- `structlog` - Логирование
- `config_reader` - Чтение конфигурации
- `typing` - Типизация

## Usage
Фильтры используются в:
- Роутерах для фильтрации сообщений
- Обработчиках для проверки прав
- Middleware для проверки подписки
- PermissionMixin для комбинирования проверок

## Error Handling
- Логирование через structlog
- Обработка ошибок конфигурации
- Обработка ошибок API Telegram
- Возврат False при любых ошибках
- Детальное логирование для отладки

## Configuration
Фильтры настраиваются через:
- BotConfig для ID админов и каналов
- Параметры при создании фильтров
- Логирование для отладки